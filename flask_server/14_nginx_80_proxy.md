



















































































































#### Nginx proxy config

Ожидаемую схему работы, я уже не раз приводил выше, уточню только, что сейчас мы будем конфигурировать ту часть, где nginx передает (проксирует) входящий запрос в gunicorn.

Напомню, что мы создали unit - файл для gunicorn, в котором указали некой точкой связи с nginx  служебный файл gunicorn.sock. Теперь он при старте системы автоматически загружается и ожидает появления в нем входящих запросов. 

Теперь нам необходимо сконфигурировать nginx, что бы он так же передавал в этот системный файл (сокет, если хотите) входящие запросы. Давайте взглянем на его основной конфигурационный файл:

```bash
nano /etc/nginx/nginx.conf
```

Либо, традиционно открыть расположение используя Midnight Commander (mc)

sudo можно не использовать, поскольку пока никаких правок вносить не планируется. Давайте просто убедимся, что в конце модуля http есть такие строки:

```bash
		##
		# Virtual Host Configs
		##

include /etc/nginx/conf.d/*.conf;
include /etc/nginx/sites-enabled/*;
```

Документация говорит нам, что nginx читает конфигурацию сверху вниз, и по степени вложенности модулей. В конечном итоге система будет представлять один большой файл, где на месте этих строк будут блоки кода из файлов на которые они указывают.  Ну почти так :)



На месте 

```bash
include /etc/nginx/sites-enabled/*;
```

будут подставленный файлы из папки sites-available, на которые ссылаются ярлыки из папки sites-enabled. Но поскольку эта часть предполагает настройку нескольких доменов на одном сервере, чего не предполагает этот проект - мы ее использовать не будем, и даже удалим единственный ярлык @default из sites-enabled.

Нас интересует часть со строкой:

```bash
include /etc/nginx/conf.d/*.conf;
```

Это, так называемые drop-in файлы, которые, как мы помним из части про юниты, не только расширяют конфигурацию, но и переопределят параметры, указанные в основном файле. То есть, нам вообще не надо вносить никаких изменений в оригинальном файле, а достаточно еще раз указать параметр с требуемым значением здесь, и он будет учтен системой. 

В этом есть еще один плюс - что бы вернуть систему в дефолтное состояние достаточно будет просто удалить файл из conf.d директории.

Этот вариант в данном случае, нас устраивает, поэтому давайте создадим новый файл конфигурации:











```bash
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    # server_name your_domain www.your_domain;

    location / {
        include proxy_params;
        proxy_pass http://unix:/home/trash/flaskproject/flaskproject.sock;
    }
}
```