### Базовая установка и настройка сервера ubuntu + nginx

Глобальные, с кучей интерграций. 
https://aws.amazon.com/ru/ 
https://cloud.google.com/compute/ 
https://azure.microsoft.com/ru-ru/free/virtual-machines/ 

Попроще. 
https://www.digitalocean.com/products/droplets/  
https://www.ovhcloud.com/en/public-cloud/compute/ 

Отечественные. 
https://cloud.yandex.ru/services/compute 
https://selectel.ru/services/cloud/servers/ 
https://sbercloud.ru/ru/products/elastic-cloud-server 
https://mcs.mail.ru/cloud-servers/ 


Для личных задач можно использовать просто сервер и ходить на него напрямую по IP, но желательно использовать доменное имя, или поддомен к уже созданному

Тема серверов весьма обширна, и единой инструкции не может быть, поскольку все очень сильно зависит от требуемой конфигурации и поставленных задач.  Так же необходимо принимать в расчет инфраструктуру, в которой сервер развернут.
Например, если он работает в связке с балансировщиком нагрузки, то нет необходимости в настройке HTTPS соединений или файрвола, поскольку эти задачи выполняют другие части сети, а трафик, как правило, внутри  уже идет не зашифрованным,  используя 80 порт. 


### Коннект

Заходим по SSH на наш сервер. Публичный ключ уже должен быть размещен там хостинг провайдером в момент создания сервера. Многие провайдеры сразу создают не root пользователя, в этом случае часть с созданием нового пользователя можно пропустить и сразу перейти к настройкам SSH. 
Можно использовать либо предоставленный внешний IP адрес, либо доменное имя.

    ssh root@<server_adress>

------

Первым делом сменим пароль root:

    passwd


И обновим список репозиториев

    apt update


И обновим сами пакеты

    apt upgrade


### Пользователи.

Подключаемся по ssh и  IP, как правило это будет root. Многие предпочитают провести первую настройку сервера под ним, и только потом создать пользователя для обслуживания.

Я сделаю пользователя сразу и добавлю его в группу sudo.


##### Создадим пользователя:

```bash
adduser dummy
```

В результате выполнения команды adduser будут выполнены следующие действия: 
- Создается новый пользователь с именем, которое вы указали при выполнении команды 
- Создается группа с тем же именем 
- Создается домашний каталог пользователя в директории /home/имя_пользователя 
- В домашний каталог копируются файлы из директории /etc/skel 
В данной директории хранятся файлы, которые копируются в домашний каталог всех новых пользователей. Скорее всего в нашем случае она будет пустой.


##### Добавим пользователя в sudoers:

Поскольку наш сервер базируется на Ubuntu, то мы укажем название группы - sudo

```bash
usermod -aG sudo dummy
```

На некоторых других дистрибутивах, необходимо использовать группу wheel:
usermod -a -G wheel dummy

Если использовать команду без параметров, пользователь будет добавлен только в указанную группу, все текущие будут удалены. 
-G -  группы пользователя 
-a -  добавит пользователя в группы из параметра -G, а не заменит их текущее значение 

Теперь можем посмотреть информацию о пользователе

    id dummy

И список групп в которых он состоит

    groups

Не забудьте заменить имя пользователя, которое вы только что добавили. 
По умолчанию в Ubuntu все участники группы sudo имеют полный набор привилегий sudo



Теперь отключимся от сервера и зайдем по новой от имени вновь созданного пользователя.

```bash
exit
```

И зайдем по новой от имени вновь созданного пользователя.

```bash
ssh dummy@<server_adress>
```



### Настройка SSH

Логинится при помощи связки логин-пароль не является безопасным методом.
Скорее всего вы уже зашли на сервер при помощи ключа, публичную часть которого предоставили хостинг-провайдеру в момент создания сервера. Если вам был предоставлен root доступ, то необходимо создать пару ключей вновь созданному на прошлом шаге пользователю для возможности его логина по ним, если же провайдер уже создал пользователя за вас, то скорее всего часть шагов по созданию ключа и копированию на сервер можно пропустить.
Однако, если вы планируете заходить на сервер не только с этого устройства, например, сейчас вы за стационарным ПК, но так же хотите использовать ноутбук для работы, то лучше не копировать приватный ключ на него а создать еще одну пару. Вообще правильнее, для каждого устройства создавать новую пару ключей, регистрируя публичную часть на сервере, так гораздо проще отзывать доступы при компрометации устройств или ключей. 
Ну а если вы планируете предоставить доступ своему другу - то вообще лучше создать отдельного пользователя, добавив его в требуемые группы.


##### Создание пары ключей

Внимание! 
Не на сервере, а на устройстве, с которого вы планируете заходить на сервер необходимо создать приватный и публичный ключи. 

Для этого откроем терминал и напечатаем:

     ssh-keygen

Я предполагаю, что вы используете Linux или MacOS. Если вы используете ОС Windows, то вам придется самостоятельно поискать информацию о порядке генерации ключей, поскольку описанный здесь метод вам не подойдет.

Генератор предложит вам указать уникальное название ключа, защитить его дополнительно паролем, и вроде бы будет еще пара вопросов, которые никто не читает.

Уникальное имя лучше придумать, это поможет когда ключей у вас станет больше чем один, а  с паролем решайте сами.

В итоге у вас будет два файла: you_key - это ваш приватный ключ, его необходимо поместить в папку ./ssh вашей домашней директории. И you_key.pub - это, соответственно, публичная часть, содержимое которого необходимо передать на наш сервер записав с новой строки в файл ~/.ssh/authorized_keys

Самый быстрый путь - воспользоваться входящей в пакет openSSH утилитой

    ssh-copy-id dummy@<server_adress>


Либо скопировать и вставить в файл на сервере содержимое ключа самостоятельно

```
cat you_key.pub
```


Для удобства, большой точности и безопасности копирования в буфер можно воспользоваться утилитами xclip для Linux или pbcopy для MacOS.

После записи публичной части ключа уместно будет проверить права на папку и файлы.  

> Сама директория должна иметь права 700 (drwx------). 
> Закрытый ключ (без расширения) должен иметь права 600 (-rw------). 
> Все остальные файлы в директории должны иметь права 644 (-rw------).
> Все файлы должны принадлежать текущему пользователю и его группе.


Если что то не так, воспользуйтесь стандартной командой для назначения соответствующих прав 

```bash
chown -R $USER:$USER ~/.ssh
chmod 700 ~/.ssh
chmod 644 ~/.ssh/*
chmod 600 ~/.ssh/id_rsa ~/.ssh/id_dsa ~/.ssh/authorized_keys
```


Осталось внести небольшие но важные корректировки в конфиг нашего SSH сервера



### установка компонентов
mc, git, curl, wget, rsync, zip, unzip

Tags:
  server